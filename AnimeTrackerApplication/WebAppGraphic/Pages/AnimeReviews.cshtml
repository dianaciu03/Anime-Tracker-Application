@page
@using Logic.Reviews
@model WebAppGraphic.Pages.AnimeReviewsModel
@{
    ViewData["Title"] = "Anime reviews";
    int? id = HttpContext.Session.GetInt32("userId");
    if (id != null)
    {
        Layout = "_LayoutLogout";
    }
    else
    {
        Layout = "_Layout";
    }
    int countPersonalReviews = 0;
    
}

<div class="background-img-community"></div>
<h1 style="padding-bottom:-2rem; margin-bottom:0;" class="second-title text-white">Your contributions</h1>
@if (Model.CurrentProfile != null) 
{
    <div class="container-fluid display-reviews bg-dark">
        @foreach (Review review in Model.GetReviews())
        {
            Model.GetProfileById(review.ProfileId);
            if (Model.Profile.Id == Model.CurrentProfile.Id)
            {
                Model.GetAnimeById(review.ContentId);
                countPersonalReviews++;
                int idReviewInEditMode = Model.IdReviewInEditMode;
                if (review.Id == idReviewInEditMode)
                {
                    <form method="post" asp-page-handler="SubmitChanges">
                    <div class="review-container text-white">
                        <img src="@Model.Anime.ImageURL" alt="Anime Picture" class="anime-picture">
                        <div>
                            <p class="anime-name">User: @Model.Profile.Username</p>
                            <p style="margin-top:15px;" class="anime-name">@Model.Anime.Name</p>
                            <p class="time-ago">@Model.CalculateTime(review.Date)</p>
                            <div class="form-group">
                                <label asp-for="ReviewRating">Rating: (x/5 ⭐)</label>
                                <input asp-for="ReviewRating" type="number" min="1" max="5" step="1" value="@Model.ReviewRating" required>
                            </div>
                            <div class="form-group">
                                <label asp-for="ReviewDescription">Description:</label>
                                <textarea asp-for="ReviewDescription" style="margin-bottom:0;" value="@Model.ReviewDescription" required></textarea>
                            </div>
                        </div>
                        <div>
                            <button id="submitReview" type="submit" class="btn btn-content-details" name="action" value="@review.Id">Submit changes</button>
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        </div>  
                    </div>
                    </form>
                }
                else 
                {
                <div class="review-container text-white">

                    <img src="@Model.Anime.ImageURL" alt="Anime Picture" class="anime-picture">
                    <div>
                        <p class="anime-name">User: @Model.Profile.Username</p>
                        <p style="margin-top:15px;" class="anime-name">@Model.Anime.Name</p>
                        <p class="time-ago">@Model.CalculateTime(review.Date)</p>
                        <p class="rating">Rating: @review.Rating⭐</p>
                        <p class="review-description">@review.Description</p>
                    </div>
                    <form method="post" asp-page-handler="EditReview">
                        <input type="hidden" name="action" value="@review.Id" />
                        <button id="enableEdit" type="submit" class="btn btn-content-details">Edit</button>
                    </form>
                </div>
                }
            }
        }
    </div>
}
@if (countPersonalReviews == 0)
{
    <h4 style="font-style:italic;" class="second-subtitle text-white">Seems like you don't have any contributions.</h4>
}

<div class="container-fluid display-reviews bg-dark">
    <h1 style="padding-left:0;" class="second-title text-white">All reviews</h1>
    @foreach (Review review in Model.GetReviews())
    {
        Model.GetProfileById(review.ProfileId);
        @if (Model.CurrentProfile == null || Model.Profile.Id != Model.CurrentProfile.Id) 
        {
            Model.GetAnimeById(review.ContentId);
            <div class="review-container text-white">
                <img src="@Model.Anime.ImageURL" alt="Anime Picture" class="anime-picture">
                <div>
                    <p class="anime-name">User: @Model.Profile.Username</p>
                    <p style="margin-top:15px;" class="anime-name">@Model.Anime.Name</p>
                    <p class="time-ago">@Model.CalculateTime(review.Date)</p>
                    <p class="rating">Rating: @review.Rating⭐</p>
                    <p class="review-description">@review.Description</p>
                </div>
            </div>
        } 
    }
</div>

